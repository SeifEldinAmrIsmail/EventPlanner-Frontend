<div class="page">
  <div class="loading" *ngIf="busy"></div>

  <div class="panel">
    <header class="header">
      <h2>Search events</h2>
      <p class="sub">Filter by keyword, date range, and role.</p>
    </header>

    <form [formGroup]="form" class="filters" role="search">
      <input
        formControlName="q"
        type="text"
        class="input"
        placeholder="Keywords: title, locationâ€¦"
        aria-label="Search keywords"
      />

      <div class="dates">
        <label>
          <span>From</span>
          <input formControlName="from" type="date" class="input" />
        </label>
        <label>
          <span>To</span>
          <input formControlName="to" type="date" class="input" />
        </label>
      </div>

      <div class="seg">
        <button type="button" class="seg-btn"
                [class.active]="form.value.role==='all'"
                (click)="form.patchValue({ role: 'all' })">All</button>
        <button type="button" class="seg-btn"
                [class.active]="form.value.role==='organizer'"
                (click)="form.patchValue({ role: 'organizer' })">Organizer</button>
        <button type="button" class="seg-btn"
                [class.active]="form.value.role==='attendee'"
                (click)="form.patchValue({ role: 'attendee' })">Attendee</button>

        <button type="button" class="clear" (click)="clear()">Clear</button>
      </div>
    </form>

    <div class="alert error" *ngIf="error">{{ error }}</div>

    <div class="results" *ngIf="results.length; else none">
      <div class="row" *ngFor="let e of results">
        <div class="left">
          <div class="title">{{ e.title }}</div>
          <div class="meta">
            <span>ğŸ“… {{ e.date | date:'mediumDate' }}</span>
            <span>â° {{ e.time }}</span>
            <span>ğŸ“ {{ e.location }}</span>
            <!-- âœ… Avoid template type error even if EventSummary has no 'role' -->
            <span class="role" *ngIf="$any(e).role">â€¢ {{$any(e).role}}</span>
          </div>
        </div>
        <div class="right">
          <a class="btn" [routerLink]="['/events', e.id]">View</a>
        </div>
      </div>
    </div>

    <ng-template #none>
      <div class="empty">
        <p>No matching events.</p>
      </div>
    </ng-template>
  </div>
</div>
